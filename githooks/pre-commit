#!/bin/bash

echo "=== Running Git Hook: pre-commit ==="

# Check if any Python files are staged
FILES=$(git diff --cached --name-only | grep '\.py$')

if [ "$FILES" != "" ]; then
    echo "üõ°Ô∏è Python files staged. Running Bandit..."

    # Run Bandit using bandit.yaml config
    bandit -r . -f csv -o bandit_report.csv -c bandit.yaml

    # Verify report creation
    if [ -f bandit_report.csv ]; then
        echo "‚úÖ Bandit scan complete. Report saved to bandit_report.csv"
    else
        echo "‚ùå Bandit report not created. Check Bandit or permissions."
        exit 1
    fi
else
    echo "‚ö†Ô∏è No Python files staged. Skipping Bandit scan."
fi
