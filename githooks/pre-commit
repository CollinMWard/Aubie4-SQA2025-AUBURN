#!/bin/bash

echo "=== Running Git Hook: pre-commit ==="

# Only proceed if Python files are staged
FILES=$(git diff --cached --name-only | grep '\.py$')

if [ "$FILES" != "" ]; then
    echo "üõ°Ô∏è Python files staged. Running Bandit..."

    # Activate the KUBESEC env (must exist for each user)
    conda activate KUBESEC

    # Run Bandit scan
    bandit -r . -f csv -o bandit_report.csv -c bandit.yaml
    

    if [ -f bandit_report.csv ]; then
        echo "‚úÖ Bandit scan complete. Report saved to bandit_report.csv"
    else
        echo "‚ùå Bandit report not created."
        exit 1
    fi
else
    echo "‚ö†Ô∏è No Python files staged. Skipping Bandit scan."
fi
