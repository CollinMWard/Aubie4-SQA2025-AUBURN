#!/bin/bash

echo "=== Running Git Hook: pre-commit ==="

# Detect staged .py files
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$')

if [ "$FILES" != "" ]; then
    echo "üõ°Ô∏è  Python files staged. Running Bandit scan..."
    
    # Use full path to avoid PATH issues (adjust path if needed)
    BANDIT_PATH=$(which bandit)

    echo "Bandit found at: $BANDIT_PATH"

    if [ "$BANDIT_PATH" = "" ]; then
        echo "‚ùå Bandit not found. Is it in your PATH?"
        exit 1
    fi

    # Run Bandit on the entire repo
    bandit -r . -f csv -o bandit_report.csv

    # Check if file was created
    if [ -f bandit_report.csv ]; then
        echo "‚úÖ bandit_report.csv successfully created in project root"
    else
        echo "‚ùå bandit_report.csv not created. Something went wrong."
        exit 1
    fi
else
    echo "No Python files staged. Skipping Bandit scan."
fi
