#!/bin/bash

echo "=== Running Git Hook: pre-commit ==="

FILES=$(git diff --cached --name-only | grep '\.py$')

if [ "$FILES" != "" ]; then
    echo "üõ°Ô∏è Python files staged. Running Bandit..."

    # Default fallback (Linux/Mac)
    BANDIT="./.venv/bin/bandit"
    # If on Windows Git Bash, switch to Windows path
    if [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" || "$OSTYPE" == "cygwin" ]]; then
        BANDIT="./.venv/Scripts/bandit.exe"
    fi

    if [ ! -f "$BANDIT" ]; then
        echo "‚ùå Bandit not found in .venv. Please run 'pip install bandit' in .venv"
        exit 1
    fi

    $BANDIT -r . -f csv -o bandit_report.csv --exclude .venv

    if [ -f bandit_report.csv ]; then
        echo "‚úÖ Bandit scan complete. Report saved to bandit_report.csv"
    else
        echo "‚ùå Bandit report not created."
    fi
else
    echo "‚ö†Ô∏è No Python files staged. Skipping Bandit."
fi
